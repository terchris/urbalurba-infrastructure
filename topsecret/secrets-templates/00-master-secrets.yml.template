# Master Secrets Template
# Contains all secrets combined into single secrets per namespace
# Edit this file to customize secrets
# Edit user-templates/00-master-secrets.yml.template instead
# Generated on: ${GENERATION_DATE}

# ================================================================
# DEFAULT NAMESPACE SECRETS
# ================================================================
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: default
type: Opaque
stringData:
  # ================================================================
  # DOMAIN CONFIGURATION FOR AUTH10
  # ================================================================
  AUTH10_DOMAINS: |
    localhost:
      enabled: true
      base_domain: "localhost"
      protocol: "http"
      description: "Local development domain"
    tailscale:
      enabled: true
      base_domain: "your-domain.ts.net"
      protocol: "https"
      description: "Tailscale MagicDNS domain"
    cloudflare:
      enabled: true
      base_domain: "your-domain.com"
      protocol: "https"
      description: "Cloudflare external domain"

  # ================================================================
  # PROTECTED SERVICES CONFIGURATION FOR AUTH10
  # ================================================================
  AUTH10_PROTECTED_SERVICES: |
    - name: whoami
      type: proxy
      description: "Whoami test service"
      domains: ["localhost", "tailscale", "cloudflare"]
      application_slug: "whoami-app"

  # ================================================================
  # ELASTICSEARCH
  # ================================================================
  ELASTICSEARCH_USERNAME: "elasticsearch-admin"
  ELASTICSEARCH_PASSWORD: "${ADMIN_PASSWORD}"

  # ================================================================
  # MULTIPASS DASHBOARD TOKEN
  # ================================================================
  MULTIPASS-MICROK8S-DASHBOARD-TOKEN: eyJhb.....

  # ================================================================
  # POSTGRESQL CONFIGURATION
  # ================================================================
  PGPASSWORD: "${PGPASSWORD}"
  PGHOST: "${PGHOST}"

  # ================================================================
  # MYSQL CONFIGURATION
  # ================================================================
  MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
  MYSQL_HOST: "${MYSQL_HOST}"
  MYSQL_DATABASE: mydatabase
  MYSQL_USER: myuser
  MYSQL_PASSWORD: "${MYSQL_ROOT_PASSWORD}"

  # ================================================================
  # MONGODB CONFIGURATION
  # ================================================================
  MONGODB_ROOT_USER: root
  MONGODB_ROOT_PASSWORD: "${MONGODB_ROOT_PASSWORD}"

  # MongoDB is set up and initialized for use by Gravitee
  GRAVITEE_MONGODB_DATABASE_NAME: graviteedb
  GRAVITEE_MONGODB_DATABASE_USER: gravitee_user
  GRAVITEE_MONGODB_DATABASE_PASSWORD: "${MONGODB_ROOT_PASSWORD}"

  # ================================================================
  # PGADMIN CONFIGURATION
  # ================================================================
  PGADMIN_DEFAULT_EMAIL: "${DEFAULT_ADMIN_EMAIL}"
  PGADMIN_DEFAULT_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"

  # ================================================================
  # REDIS CONFIGURATION
  # ================================================================
  REDIS_HOST: "${REDIS_HOST}"
  REDIS_PORT: "6379"
  REDIS_PASSWORD: "${REDIS_PASSWORD}"

  # ================================================================
  # RABBITMQ CONFIGURATION
  # ================================================================
  RABBITMQ_HOST: "${RABBITMQ_HOST}"
  RABBITMQ_PORT: "5672"
  RABBITMQ_MANAGEMENT_PORT: "15672"
  RABBITMQ_USERNAME: "${RABBITMQ_USERNAME}"
  RABBITMQ_PASSWORD: "${RABBITMQ_PASSWORD}"

  # ================================================================
  # GRAVITEE.IO API MANAGEMENT SYSTEM
  # ================================================================
  
  # Gravitee admin user
  GRAVITEE_ADMIN_EMAIL: "${DEFAULT_ADMIN_EMAIL}"
  GRAVITEE_ADMIN_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"

  # Gravitee domain names
  # NOTE: These reference old Cloudflare variables that are no longer used
  # Gravitee must be refactored to use the new Cloudflare tunnel setup approach
  # (820-cloudflare-tunnel-setup.sh and 821-cloudflare-tunnel-deploy.sh)
  #    GRAVITEE_TEST_CLOUDFLARE_DOMAIN is a pointer to this variable
  #GRAVITEE_TEST_CLOUDFLARE_DOMAIN: CLOUDFLARE_TEST_DOMAINNAME
  #    GRAVITEE_TEST_CLOUDFLARE_TUNNELNAME is a pointer to this variable
  #GRAVITEE_TEST_CLOUDFLARE_TUNNELNAME: CLOUDFLARE_TEST_TUNNELNAME
  # The main gateway where external developers and applications send API requests to access the APIs managed by Gravitee. (eg: api.nerdmeet.org)
  GRAVITEE_TEST_GATEWAY_SUBDOMAIN: gateway-test
  # The backend API that handles all management operations for Gravitee APIM, used by the management UI and for programmatic administration. (eg management-api.nerdmeet.org)
  GRAVITEE_TEST_MANAGEMENT_API_SUBDOMAIN: management-api-test
  # The web-based developer portal where API consumers can discover, test, and subscribe to APIs, as well as access documentation and manage their accounts.( eg portal.nerdmeet.org)
  GRAVITEE_TEST_DEV_PORTAL_SUBDOMAIN: portal-test
  # The web-based management interface where administrators configure and manage APIs, monitor traffic, set policies, and perform other administrative tasks for the Gravitee APIM platform. (eg:  management.nerdmeet.org)
  GRAVITEE_TEST_MANAGEMENT_CONSOLE_SUBDOMAIN: management-test
  # The backend API that serves data to the developer portal, handling operations like API discovery, documentation retrieval, and developer account management. (eg portal-api.nerdmeet.org)
  GRAVITEE_TEST_DEV_PORTAL_API_SUBDOMAIN: portal-api-test

  # Gravitee encryption key (used for encrypting sensitive data)
  GRAVITEE_ENCRYPTION_KEY: EncryptionKey${DEFAULT_ADMIN_PASSWORD}  # Generate a secure random string for this

  # ================================================================
  # GRAFANA ADMIN CREDENTIALS
  # ================================================================
  # For checking logging
  grafana-admin-user: "${DEFAULT_ADMIN_EMAIL}"
  grafana-admin-password: "${DEFAULT_ADMIN_PASSWORD}"

  # ================================================================
  # REDIS COMMANDER CONFIGURATION
  # ================================================================
  # Web UI to see what is going on - must have for debugging
  redis-commander-username: "${DEFAULT_ADMIN_EMAIL}"
  redis-commander-password: "MyCustomRedisCommanderPassword999"

  # ================================================================
  # TAILSCALE CONFIGURATION
  # ================================================================
  # REMEMBER these keys expire in max 90 days -
  TAILSCALE_SECRET: "${TAILSCALE_SECRET}"
  # the TAILSCALE_SECRET is used by 801-tailscale-host-setup.sh when adding hosts to the network ( https://login.tailscale.com/admin/settings/keys ) to generate the auth key
  TAILSCALE_TAILNET: "${TAILSCALE_TAILNET}"
  # the TAILSCALE_TAILNET is the name of the tailscale network - eg your github id
  TAILSCALE_DOMAIN: "${TAILSCALE_DOMAIN}"
  # the domain name is manually set in the portal here https://login.tailscale.com/admin/dns
  TAILSCALE_CLUSTER_HOSTNAME: "${TAILSCALE_CLUSTER_HOSTNAME}"
  # the TAILSCALE_CLUSTER_HOSTNAME is used by 802-tailscale-cluster-setup.sh as the wildcard ingress point
  # this creates a device that routes all *.k8s.dog-pence.ts.net traffic to Traefik for internal routing

  # these to you get here: https://login.tailscale.com/admin/settings/oauth
  TAILSCALE_CLIENTID: "${TAILSCALE_CLIENTID}"
  # the TAILSCALE_CLIENTID is used by 802-tailscale-cluster-setup.sh and 804-tailscale-tunnel-delete.sh for API access
  TAILSCALE_CLIENTSECRET: "${TAILSCALE_CLIENTSECRET}"
  # the TAILSCALE_CLIENTSECRET is used with TAILSCALE_CLIENTID for Tailscale API operations

  # ================================================================
  # CLOUDFLARE CONFIGURATION
  # ================================================================
  # for Cloudflare tunnel and DNS (for exposing services on the internet)
  CLOUDFLARE_DNS_TOKEN: "${CLOUDFLARE_DNS_TOKEN}"
  CLOUDFLARE_TEST_TUNNELNAME: ""
  CLOUDFLARE_TEST_DOMAINNAME: ""
  CLOUDFLARE_TEST_SUBDOMAINS: ""
  
  CLOUDFLARE_PROD_TUNNELNAME: ""
  CLOUDFLARE_PROD_DOMAINNAME: ""
  CLOUDFLARE_PROD_SUBDOMAINS: ""

  # ================================================================
  # ARGOCD CONFIGURATION
  # ================================================================
  # GitOps continuous delivery credentials
  ARGOCD_ADMIN_USERNAME: "admin"
  ARGOCD_ADMIN_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"

  # ================================================================
  # GITHUB INTEGRATION
  # ================================================================
  # For CI/CD and package management
  GITHUB_ACCESS_TOKEN: "${GITHUB_ACCESS_TOKEN}"
  YOUR_GITHUB_USERNAME: "${GITHUB_USERNAME}"

  # ================================================================
  # VM/INFRASTRUCTURE CREDENTIALS
  # ================================================================
  # Ubuntu VM credentials (if using ubuntu VM and microk8s kubernetes for deployment)
  UBUNTU_VM_USER: "${UBUNTU_VM_USER}"
  UBUNTU_VM_USER_PASSWORD: "${UBUNTU_VM_USER_PASSWORD}"

  # WiFi credentials (if using ubuntu and microk8s kubernetes on a raspberry)
  WIFI_SSID: "${WIFI_SSID}"
  WIFI_PASSWORD: "${WIFI_PASSWORD}"

---
# pgadmin password (separate secret)
apiVersion: v1
kind: Secret
metadata:
  name: pgadmin4-password
type: Opaque
stringData:
  password: "${ADMIN_PASSWORD}"

---
# Cloudflare tunnel credentials
apiVersion: v1
kind: Secret
metadata:
  name: cloudflared-credentials
  namespace: default
  labels:
    cloudflare.tunnel/domain: urbalurba.no
type: Opaque
stringData:
  cloudflare-tunnel.json: |
    {"AccountTag":"97e30a13fdbed4f09e53db9aba18d144","TunnelSecret":"BgkuqcQl1UNrYCchVhUqGnjkr0qcCuVAEjjWDMprW4U=","TunnelID":"82905721-51ba-4db3-8f0e-fd3b12c93564","Endpoint":""}

---
# Secret for GitHub Container Registry credentials - you need it for automatic deploy - the containers are stored here
apiVersion: v1
kind: Secret
metadata:
  name: ghcr-credentials
  namespace: default
type: kubernetes.io/dockerconfigjson
stringData:
  .dockerconfigjson: |
    {
      "auths": {
        "ghcr.io": {
          "username": "${GITHUB_USERNAME}",
          "password": "${GITHUB_ACCESS_TOKEN}",
          "auth": "dGXXXXXXX=="
        }
      }
    }

# ================================================================
# AI NAMESPACE SECRETS
# ================================================================
---
# Define the ai namespace first
apiVersion: v1
kind: Namespace
metadata:
  name: ai

---
# secrets for ai namespace
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: ai
type: Opaque
stringData:
  # ================================================================
  # OPEN-WEBUI CONFIGURATION
  # ================================================================

  # These are for the script that creates the database for openwebui and enables the vector functionality u06-openwebui-create-postgres.yml
  OPENWEBUI_POSTGRES_USER: openwebui
  OPENWEBUI_POSTGRES_PASSWORD: "${DEFAULT_DATABASE_PASSWORD}"
  OPENWEBUI_POSTGRES_DB: openwebui

  # This is the connection string in full that openwebui uses to connect to the database
  DATABASE_URL: postgresql://openwebui:${DEFAULT_DATABASE_PASSWORD}@${PGHOST}:5432/openwebui

  # for OpenAI API integration - OpenAI API key for embeddings and models  The default value in open-webui helm is "0p3n-w3bu!"
  OPENWEBUI_OPENAI_API_KEY: "sk-${DEFAULT_ADMIN_PASSWORD}"

  # LiteLLM provider API keys
  AZURE_API_KEY: "azure-key-placeholder"
  AZURE_API_BASE: "https://your-endpoint.openai.azure.com"
  OPENAI_API_KEY: "openai-key-placeholder"
  ANTHROPIC_API_KEY: "your-anthropic-api-key-here"
  # LiteLLM master key - this needs to match OPENWEBUI_OPENAI_API_KEY for the integration to work
  LITELLM_PROXY_MASTER_KEY: "sk-1234567890abcdef"  # Must follow format: sk-[alphanumeric] for LiteLLM validation

  # LiteLLM PostgreSQL database credentials - for LiteLLM proxy database connection
  LITELLM_POSTGRESQL__USER: "litellm"
  LITELLM_POSTGRESQL__PASSWORD: "${DEFAULT_DATABASE_PASSWORD}"

  # ================================================================
  # AUTH PROVIDER FOR OPENWEBUI (AUTHENTIK)
  # ================================================================
  # This is how to set up manually in Authentik UI:
  # Before deploying this secret, configure in Authentik UI (authentik.localhost):
  # 1. Applications > Applications > Create with Provider
  # 1.1 Name: "openwebui-dev"
  # 1.2 Slug: "openwebui-dev"
  # 1.3 click Next
  # 2. Provider Type: "OAuth2/OpenID Connect"
  # 2.1 click Next
  # 3. Name: "openwebui-dev-provider"
  # 3.1 Authentication Flow: "default-provider-authorization-implicit-consent (Authorize Application)"
  # 3.2 Client Type: "Confidential"
  # 3.3 Client ID: 1c37QuM0qm0g2BzdLbhppVwmUwUUrhmB83e9inEe
  # 3.4 Client Secret: BngAuX1zthtYnyAxPePAwyTqDxfVSq09IDRUTAonRcogYmhnfj39eBk709nKF4ej1OT7OMiJWVYIrwOrdizTFiyQxapQUEpDziPNucs5yxIciEx21PkK82IgURILL06h
  # 3.5 Redirect URIs/Orgins (RegEx): Click add
  # 3.6 select "Strict" and enter "http://openwebui.localhost/oauth/oidc/callback"
  # note that it is http and not https when we use localhost
  # 3.7 Click Next
  # 4. On Configure Bindings click next (All authenticated Authentik users can access OpenWebUI dev environment )
  # 5. Review the Application and Provider click Submit

  # OAuth2/OIDC configuration for Open WebUI + Authentik integration
  OPENWEBUI_ENABLE_OAUTH_SIGNUP: "true"
  OPENWEBUI_OAUTH_MERGE_ACCOUNTS_BY_EMAIL: "true"
  OPENWEBUI_OAUTH_PROVIDER_NAME: "Authentik"
  OPENWEBUI_OAUTH_CLIENT_ID: "1c37QuM0qm0g2BzdLbhppVwmUwUUrhmB83e9inEe"
  OPENWEBUI_OAUTH_CLIENT_SECRET: "BngAuX1zthtYnyAxPePAwyTqDxfVSq09IDRUTAonRcogYmhnfj39eBk709nKF4ej1OT7OMiJWVYIrwOrdizTFiyQxapQUEpDziPNucs5yxIciEx21PkK82IgURILL06h"
  OPENWEBUI_OAUTH_SCOPES: "openid email profile groups roles"

  # notice these are http and not https when we use localhost
  # Provider URL (where Open WebUI reaches Authentik)
  OPENWEBUI_OPENID_PROVIDER_URL: "http://authentik.localhost/application/o/openwebui-dev/.well-known/openid-configuration"
  # Redirect URI (where Authentik sends user back to Open WebUI)
  OPENWEBUI_OPENID_REDIRECT_URI: "http://openwebui.localhost/oauth/oidc/callback"

# ================================================================
# LITELLM CONFIGURATION CONFIGMAP
# ================================================================
# This ConfigMap contains model configurations for LiteLLM proxy
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: litellm-config
  namespace: ai
data:
  config.yaml: |
    # General settings
    general_settings:
      master_key: os.environ/LITELLM_PROXY_MASTER_KEY

    # Model list configuration
    model_list:
      # Mac Ollama models with different temperature settings
      - model_name: mac-gpt-oss-balanced
        litellm_params:
          model: ollama/gpt-oss:20b
          api_base: "http://host.lima.internal:11434"
          temperature: 0.7

      - model_name: mac-gpt-oss-creative
        litellm_params:
          model: ollama/gpt-oss:20b
          api_base: "http://host.lima.internal:11434"
          temperature: 0.9

      - model_name: mac-gpt-oss-precise
        litellm_params:
          model: ollama/gpt-oss:20b
          api_base: "http://host.lima.internal:11434"
          temperature: 0.3

      # External Ollama models (Mac with fixed IP)
      - model_name: external-ollama-gemma3
        litellm_params:
          model: ollama/gemma3:4b
          api_base: "http://192.168.68.61:11434"
          temperature: 0.7

      # Cloud provider models with Mac fallbacks
      - model_name: gpt-4o
        litellm_params:
          model: gpt-4o
          api_key: "os.environ/OPENAI_API_KEY"
          fallbacks:
            - model: ollama/gpt-oss:20b
              api_base: "http://host.lima.internal:11434"

      - model_name: azure-gpt-4
        litellm_params:
          model: azure/gpt-4
          api_key: "os.environ/AZURE_API_KEY"
          api_base: "os.environ/AZURE_API_BASE"
          api_version: "2023-12-01-preview"
          fallbacks:
            - model: ollama/gpt-oss:20b
              api_base: "http://host.lima.internal:11434"

      - model_name: claude-3-opus
        litellm_params:
          model: anthropic/claude-3-opus-20240229
          api_key: "os.environ/ANTHROPIC_API_KEY"
          fallbacks:
            - model: ollama/gpt-oss:20b
              api_base: "http://host.lima.internal:11434"

# ================================================================
# ARGOCD NAMESPACE SECRETS
# ================================================================
---
# Define the argocd namespace first
apiVersion: v1
kind: Namespace
metadata:
  name: argocd

---
# secrets for argocd namespace
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: argocd
type: Opaque
stringData:
  # ================================================================
  # ARGOCD ADMIN CREDENTIALS - NOVICE USER FRIENDLY
  # ================================================================
  # Simple, predictable credentials that novice users can easily use
  ARGOCD_ADMIN_USERNAME: "admin"
  ARGOCD_ADMIN_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"

---
# ArgoCD initial admin secret (will be replaced by above credentials)
apiVersion: v1
kind: Secret
metadata:
  name: argocd-secret
  namespace: argocd
type: Opaque
stringData:
  # Admin password (bcrypt hashed version of DEFAULT_ADMIN_PASSWORD)
  # This secret will be created by ArgoCD deployment automation
  # Username: admin
  # Password: Uses ${DEFAULT_ADMIN_PASSWORD} value
  admin.password: "${ARGOCD_BCRYPT_PASSWORD}"
  admin.passwordMtime: "2025-04-15T12:00:00Z"

# ================================================================
# JUPYTERHUB NAMESPACE SECRETS
# ================================================================
---
# Define the jupyterhub namespace first
apiVersion: v1
kind: Namespace
metadata:
  name: jupyterhub

---
# secrets for jupyterhub namespace
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: jupyterhub
type: Opaque
stringData:
  # ================================================================
  # JUPYTERHUB CONFIGURATION
  # ================================================================

  # Authentication password for DummyAuthenticator
  JUPYTERHUB_AUTH_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"

# ================================================================
# UNITY-CATALOG NAMESPACE SECRETS
# ================================================================
---
# Define the unity-catalog namespace first
apiVersion: v1
kind: Namespace
metadata:
  name: unity-catalog

---
# secrets for unity-catalog namespace
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: unity-catalog
type: Opaque
stringData:
  # ================================================================
  # UNITY CATALOG OSS CONFIGURATION
  # ================================================================

  # Database connection for Unity Catalog metadata storage
  # Unity Catalog will create its own database within PostgreSQL
  UNITY_CATALOG_DATABASE_URL: "postgresql://postgres:${PGPASSWORD}@${PGHOST}:5432/unity_catalog"
  UNITY_CATALOG_DATABASE_USER: "postgres"
  UNITY_CATALOG_DATABASE_PASSWORD: "${PGPASSWORD}"  # Should match PGPASSWORD

  # Unity Catalog server configuration
  UNITY_CATALOG_SERVER_HOST: "0.0.0.0"
  UNITY_CATALOG_SERVER_PORT: "8080"

  # Authentication configuration (simple auth for development)
  UNITY_CATALOG_AUTH_MODE: "SIMPLE"

  # Optional: Admin user for Unity Catalog (if using authentication)
  UNITY_CATALOG_ADMIN_USER: "admin"
  UNITY_CATALOG_ADMIN_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"

  # Storage configuration
  UNITY_CATALOG_WAREHOUSE_DIR: "/tmp/unity-catalog/warehouse"

  # Logging configuration
  UNITY_CATALOG_LOG_LEVEL: "INFO"

# ================================================================
# MONITORING NAMESPACE SECRETS
# ================================================================
---
# Define the monitoring namespace first
apiVersion: v1
kind: Namespace
metadata:
  name: monitoring

---
# secrets for monitoring namespace
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: monitoring
type: Opaque
stringData:
  # ================================================================
  # GRAFANA ADMIN CREDENTIALS
  # ================================================================
  grafana-admin-user: "admin"
  grafana-admin-password: "${DEFAULT_ADMIN_PASSWORD}"

# ================================================================
# AUTHENTIK NAMESPACE SECRETS
# ================================================================
---
# Define the authentik namespace first
apiVersion: v1
kind: Namespace
metadata:
  name: authentik

---
# secrets for authentik namespace
apiVersion: v1
kind: Secret
metadata:
  name: urbalurba-secrets
  namespace: authentik
type: Opaque
stringData:
  # ================================================================
  # AUTHENTIK CONFIGURATION
  # ================================================================
  
  # Secret key for Authentik encryption (generate with: openssl rand 60 | base64 -w 0)
  AUTHENTIK_SECRET_KEY: "${AUTHENTIK_SECRET_KEY}"

  # PostgreSQL configuration (double underscore per Authentik convention)
  AUTHENTIK_POSTGRESQL__HOST: "${PGHOST}.svc.cluster.local"
  AUTHENTIK_POSTGRESQL__NAME: "authentik"
  AUTHENTIK_POSTGRESQL__USER: "authentik"
  AUTHENTIK_POSTGRESQL__PASSWORD: "${PGPASSWORD}"

  # Redis configuration
  AUTHENTIK_REDIS__HOST: "${REDIS_HOST}"
  AUTHENTIK_REDIS__PASSWORD: "${REDIS_PASSWORD}"

  # Bootstrap admin account
  AUTHENTIK_BOOTSTRAP_EMAIL: "${DEFAULT_ADMIN_EMAIL}"
  AUTHENTIK_BOOTSTRAP_PASSWORD: "${DEFAULT_ADMIN_PASSWORD}"
