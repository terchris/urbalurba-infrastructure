# File: manifests/076-authentik-localhost-ingressroute.yaml
#
# Description:
# Separate IngressRoute for localhost access without CSP upgrade
# This prevents HTTP requests from being upgraded to HTTPS on localhost
# which would cause ERR_CERT_AUTHORITY_INVALID errors
#
# Usage:
# kubectl apply -f 076-authentik-localhost-ingressroute.yaml
#
# This replaces the main IngressRoute for localhost access only

---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: authentik-server-localhost
  namespace: authentik
  labels:
    app: authentik
    component: server
    type: localhost
    routing: localhost-only
    app.kubernetes.io/name: authentik
    app.kubernetes.io/component: server
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`authentik.localhost`)
      kind: Rule
      services:
        - name: authentik-server
          port: 80
      # No CSP middleware - allows HTTP to remain HTTP
