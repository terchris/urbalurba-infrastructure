# File: manifests/741-pgadmin-ingressroute.yaml
#
# Description:
# IngressRoute for pgAdmin PostgreSQL administration interface
# Provides web access to pgAdmin for database management
# Automatically handles both internal (.localhost) and external domains
# Routes to pgAdmin service for PostgreSQL administration
#
# HostRegexp Routing:
# This IngressRoute uses HostRegexp('pgadmin\..+') to automatically handle:
# - pgadmin.localhost (internal development access)
# - pgadmin.urbalurba.no (external access via Cloudflare tunnel)
# - Any future domains (future-proof routing)
#
# Usage:
# kubectl apply -f 741-pgadmin-ingressroute.yaml
#
# Dependencies:
# - pgAdmin service must exist (deployed via Helm)
# - PostgreSQL must be deployed and accessible
#
# Testing:
# Internal: curl http://pgadmin.localhost
# External: curl https://pgadmin.urbalurba.no
# Both should return pgAdmin web interface
#
# Integration:
# - Routes both internal and external domains to pgAdmin service automatically
# - No authentication middleware (pgAdmin has built-in authentication)
# - Enables seamless switching between development and production access
# - Integrates with PostgreSQL database for administration
#
# Cluster Standards Compliance:
# - Uses traefik.io/v1alpha1 API version
# - IngressRoute CRD (not standard Kubernetes Ingress)
# - Follows established cluster ingress standards
# - Implements HostRegexp pattern for unified routing
#
# HostRegexp Pattern Explanation:
# - 'pgadmin\..+' matches any domain that starts with 'pgadmin.'
# - Examples: pgadmin.localhost, pgadmin.urbalurba.no, pgadmin.example.com
# - The '\.' escapes the literal dot, '+' matches one or more characters
# - This enables automatic external access without duplicating IngressRoute rules

---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: pgadmin
  namespace: default
  labels:
    app: pgadmin
    type: management
    routing: unified
spec:
  entryPoints:
    - web
  routes:
    - match: HostRegexp(`pgadmin\..+`)
      kind: Rule
      services:
        - name: pgadmin-pgadmin4
          port: 80