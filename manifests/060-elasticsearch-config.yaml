# 060-elasticsearch-config.yaml
# Elasticsearch deployment using Elastic's official Helm chart
#
# Repository: https://helm.elastic.co
# Chart: elastic/elasticsearch
#
# This configuration deploys a single-node Elasticsearch instance
# optimized for local development and testing.
#
# Installation:
# helm repo add elastic https://helm.elastic.co
# helm install elasticsearch elastic/elasticsearch -f 060-elasticsearch-config.yaml -n search --create-namespace
#
# Uninstall:
# helm uninstall elasticsearch -n search

# Single node configuration
# NOTE: Do NOT set discovery.type: single-node in esConfig - the chart handles
# single-node mode automatically when replicas: 1, and setting it explicitly
# causes conflict with cluster.initial_master_nodes
replicas: 1

# Allow scheduling on single-node clusters
antiAffinity: "soft"

# Disable security for local development
esConfig:
  elasticsearch.yml: |
    xpack.security.enabled: false
    cluster.routing.allocation.disk.threshold_enabled: false

# Use HTTP protocol (required when security is disabled)
protocol: http

# JVM heap settings
esJavaOpts: "-Xmx512m -Xms512m"

# Resource limits
resources:
  requests:
    cpu: "250m"
    memory: "1Gi"
  limits:
    cpu: "1000m"
    memory: "1Gi"

# Persistence settings
volumeClaimTemplate:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 8Gi

# Service configuration
service:
  type: ClusterIP

# Disable certificate generation (not needed without security)
createCert: false

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000

securityContext:
  capabilities:
    drop:
      - ALL
  runAsNonRoot: true
  runAsUser: 1000

# Readiness probe settings
readinessProbe:
  failureThreshold: 10
  initialDelaySeconds: 30
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: 5

# Cluster health check color (yellow is OK for single node)
clusterHealthCheckParams: "wait_for_status=yellow&timeout=1s"
